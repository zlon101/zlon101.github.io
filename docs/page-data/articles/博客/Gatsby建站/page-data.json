{"componentChunkName":"component---src-templates-post-js","path":"/articles/博客/Gatsby建站/","result":{"data":{"markdownRemark":{"fields":{"articlePath":"/articles/博客/Gatsby建站/"},"html":"<blockquote>\n<p>Gatsby是一个基于 React 架构的静态站点生成器，可以让你体验React的所有优点。Gatsby有一个预先配置好的Webpack，使用它入门React会省下很多麻烦，此外Gatsby会根据你的目录结构自动生成路由。所有的HTML都会在服务器端渲染，弥补了客户端渲染的不足。</p>\n</blockquote>\n<h1>参考</h1>\n<ul>\n<li><a href=\"https://www.gatsbyjs.cn/\">Gatsby中文文档</a></li>\n<li><a href=\"https://blog.crimx.com/archives\">搭建 Gatsby-博客</a>    <a href=\"https://github.com/crimx/blog-2019\">Gatsby博客源码</a></li>\n<li><a href=\"https://www.gatsbyjs.org/starters/email2vimalraj/gatsby-starter-tech-blog/\">starter</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/NavizDLQXav-N2cYda8Bhg\">使用 Gatsby.js 搭建静态博客黑暗模式</a></li>\n<li><a href=\"https://www.gatsbyjs.com/blog/2017-07-19-creating-a-blog-with-gatsby/\">Creating a Blog with Gatsby</a></li>\n</ul>\n<h1>环境搭建</h1>\n<ul>\n<li>\n<p>install Node and npm</p>\n</li>\n<li>\n<p>global install gatsby-cli:  <code>npm install -g gatsby-cli</code></p>\n</li>\n<li>\n<p>创建项目：<code>gatsby new &#x3C;dir> [starter]</code></p>\n</li>\n<li>\n<p>运行服务器：<code>gatsby develop</code></p>\n</li>\n<li>\n<p>然后在pages目录下添加.md文件就能自动生成新博客文章了。\r\nGatsby 的核心自动把 <code>src/pages</code> 中的 React 组件转变为页面和 URL。比如：在 <code>src/pages/index.js</code> 和 <code>src/pages/about.js</code> 中的组件，会为网站的索引页（<code>/</code>）和 关于页（<code>/about</code>）自动创建基于文件名的页面。</p>\n</li>\n<li>\n<p><strong>命令</strong></p>\n</li>\n<li>\n<p>npm i -g gatsby-cli</p>\n</li>\n<li>\n<p>gatsby new gatsby-blog <a href=\"https://github.com/gatsbyjs/gatsby-starter-blog\">https://github.com/gatsbyjs/gatsby-starter-blog</a> (这里使用了gatsby官方提供的一个blog模板)</p>\n</li>\n<li>\n<p>最后进入 gatsby-blog 文件夹，运行 gatsby develop</p>\n</li>\n<li>\n<p>构建：gatsby build；Gatsby将为您的站点执行优化的生产构建，生成<strong>静态HTML</strong>和每个路由的JavaScript代码包。</p>\n</li>\n</ul>\n<p><strong>目录结构</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9db7663ec5559b1da2d3c758b4b923c6/97655/1562139626154.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmUlEQVQoz4VSi3KcMAzk///xLtMEMC+/n9hw25EuXJNpM/WMMNhotatVZ62F8x4xJ0ilYIyGthEhFhhjIKWEUgrOOf4OIeDxeOCn1R3HgWoc2iLhtMa8LJgmgWEY0Pc9tm1Daw17KeB/a0UpBTFGeO+RUkbKGa3sOGtDx5erRP4QyJtCP/R4u7/hdrvhdr/jqcDxTiAUIUQ4a5k5gfoQUGPCsVd0VL1ajygVtmXFPM/QWjMzAvHOY/k8O8+fpb4kU6V126CtwbKtGMeRk6lfBP4ENtxfbQwnUQ8pzvN8vV/BPWwxcRy5wHvHiWQGMaT7/62vJnVUpaWMKjUO7eCtw7pe0g2zJWfJZVLzNCK9zs5PsAu0o0c7DuzSQE8zhBAsV4iB3X5//4VxFPjoe3adgC7XcykXxT+APAoh4nSBd2biI2I+EVJDzA05Zy5ijOWRuZylluz7/p0hSa4pw0kFqw0UG0KjkhHiDusijNbcUzKGCFABCgKutf0tmahP0wQtZphlxbqtEGKE0QrzPL3cJlBi+pzJ9E9TfgOY01HnrPEOSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1562139626154\"\n        title=\"1562139626154\"\n        src=\"/static/9db7663ec5559b1da2d3c758b4b923c6/5a190/1562139626154.png\"\n        srcset=\"/static/9db7663ec5559b1da2d3c758b4b923c6/772e8/1562139626154.png 200w,\n/static/9db7663ec5559b1da2d3c758b4b923c6/e17e5/1562139626154.png 400w,\n/static/9db7663ec5559b1da2d3c758b4b923c6/5a190/1562139626154.png 800w,\n/static/9db7663ec5559b1da2d3c758b4b923c6/97655/1562139626154.png 819w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1>部署</h1>\n<blockquote>\n<p>Gatsby构建命令生成一个包含静态HTML和JavaScript文件的目录，您可以将其部署到静态站点托管服务中。</p>\n</blockquote>\n<ul>\n<li>\"gh-pages -d build\"： Github 的 gh-pages 功能发布内容。</li>\n<li>build 后push到username.github.io/repos的master分支;</li>\n<li>绑定域名：在项目的根目录新建<code>static</code> 文件夹，然后添加<code>CNAME</code>文件，写上自己的域名。</li>\n<li>域名解析：</li>\n</ul>\n<p><a href=\"https://www.gatsbyjs.com/docs/tutorial/part-one/#deploying-a-gatsby-site\">参考</a></p>\n<h1>布局组件</h1>\n<blockquote>\n<p>布局包括：页眉、页脚、侧边栏、导航栏</p>\n</blockquote>\n<p><strong>利用两个插件实现 <code>.md</code> 到 <code>html</code> 的转换</strong></p>\n<ul>\n<li><code>yarn add gatsby-transformer-remark gatsby-source-filesystem</code></li>\n<li><code>gatsby-source-filesystem</code> (Source plugins) 获取数据， <code>gatsby-transformer-remark</code> (<em>transformer</em> plugins) 对 markdown 文件解析后会生成 <code>MarkdownRemark</code></li>\n<li><code>gatsby-transformer-remark</code> 解析 Markdown 并获取文件里面的数据</li>\n</ul>\n<p><strong>修改配置文件</strong></p>\n<ul>\n<li>\n<p>gatsby-config.js</p>\n<deckgo-highlight-code language=\"javascript\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">module.exports = {\r\n  siteMetadata: {\r\n    title: &#39;Gatsby Default Starter&#39;,\r\n  },\r\n  plugins: [\r\n    &#39;gatsby-plugin-react-helmet&#39;,\r\n    // 添加以下两个插件，一个用于读取md文件，一个用于转换其为html\r\n    &#39;gatsby-transformer-remark&#39;,\r\n    {\r\n      resolve: &#39;gatsby-source-filesystem&#39;,\r\n      options: {\r\n        name: &#39;src&#39;,\r\n        path: `${__dirname}/src`,\r\n      },\r\n    },\r\n  ],\r\n}</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>frontmatter\r\n<code>/page</code>目录下.md文件中的‘---’ 隔开的部分(frontmatter: 网站的基本资料)会被 <code>gatsby-transformer-remark</code> 插件识别，并保存到 <code>frontmatter</code> 部分。可以通过 graphql 查询并用于页面渲染</p>\n</li>\n</ul>\n<p><strong>模板</strong></p>\n<ul>\n<li>templates</li>\n</ul>\n<deckgo-highlight-code language=\"javascript\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">//templates 模板\r\nimport React from &#39;react&#39;;\r\nimport Helmet from &#39;react-helmet&#39;;\r\n\r\nexport default function Template({data}) {\r\n  const {markdownRemark: post} = data;\r\n  return (\r\n    &lt;div&gt;\r\n      &lt;h1&gt;{post.frontmatter.title}&lt;/h1&gt;\r\n    &lt;/div&gt;\r\n  )\r\n}</code>\n        </deckgo-highlight-code>\n<p>参数 <code>data</code> 是由 GraphQL 传递进来的数据，也就是 Markdown 文件里面的内容。这些数据存放在markdownRemark变量当中，我们把它提取并存入post变量中，接着就可以透过<code>post.frontmatter.title</code> 使用 <code>frontmatter</code> 中的 <code>title</code> 内容。</p>\n<p><strong>生成网页</strong></p>\n<ul>\n<li>\n<p><code>/src/pages/*.js</code> 目录下的组件会自动生成相应路径的页面，但如果是其它类型的文件就不会了。</p>\n</li>\n<li>\n<p>我们用 GraphQL 取得所有的文章，用 foreach 针对每一篇文章使用 createPage 建立新页面，这里则需要用到 path 和 postTemplate</p>\n</li>\n</ul>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">createPage({\r\n  path: 页面对应的路由,\r\n  component: 模板组件,\r\n  context: {}, // 传递给模板组件的上下文 props.pageContext, 用户 graphql 的参数查询\r\n})</code>\n        </deckgo-highlight-code>\n<h2>数据查询(GraphQL)</h2>\n<blockquote>\n<p>Page queries live outside of the component definition — by convention at the end of a page component file — and are only available on page components.</p>\n</blockquote>\n<ul>\n<li>page components: <code>src/pages/*.js</code> 目录下的组件</li>\n<li>non-page components: 非 page components，如 Layout.js 不能使用 query 查询数据，改为 useStaticQuery</li>\n</ul>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">frontmatter {\r\n\tdate(formatString: &quot;DD MMMM, YYYY&quot;)\r\n}\r\n\r\nallFile {\r\n\tnodes {\r\n\t\tname\r\n\t\trelativePath\r\n\t}\r\n}\r\n\r\nallMarkdownRemark {\r\n\tedges {\r\n\t  node {\r\n\t\t\thtml\r\n\t\t\tid\r\n\t\t\tfrontmatter {\r\n\t\t  \ttitle\r\n\t\t\t}\r\n\t\t\tparent {\r\n\t\t  \t... on File {\r\n\t\t\t\tname\r\n\t\t\t\trelativePath\r\n\t\t  }\r\n\t\t}\r\n\t  }\r\n\t}\r\n}</code>\n        </deckgo-highlight-code>\n<h1>动态创建页面</h1>\n<p>Gatsby 可以使用 GraphQL 查询数据并将查询结果映射为页面</p>\n<blockquote>\n<p>步骤：</p>\n</blockquote>\n<ol>\n<li>查询数据</li>\n<li>数据映射为页面</li>\n</ol>\n<p>当动态创建页面时，需要指定一个页面模板。</p>\n<h1>API</h1>\n<ul>\n<li><a href=\"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#onCreateNode\"><code>onCreateNode</code></a></li>\n<li><a href=\"https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/#createPages\"><code>createPages</code></a></li>\n</ul>","id":"7d3607ab-56fd-50a4-b789-df8991cb7488","parent":{"name":"Gatsby建站","base":"Gatsby建站.md","mtime":"2023-07-24T07:58:23.519Z","sourceInstanceName":"markdown"}}},"pageContext":{"articlePath":"/articles/博客/Gatsby建站/"}},"staticQueryHashes":["3957182205"]}