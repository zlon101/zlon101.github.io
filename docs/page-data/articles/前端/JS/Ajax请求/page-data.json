{"componentChunkName":"component---src-templates-post-js","path":"/articles/前端/JS/Ajax请求/","result":{"data":{"markdownRemark":{"fields":{"articlePath":"/articles/前端/JS/Ajax请求/"},"html":"<h4>客服端</h4>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">window.onload = function winLoad(){\n    var form = document.querySelector(&#39;form&#39;);\n    var select = document.querySelector(&#39;select&#39;);\n    var input = document.querySelector(&#39;input[type=&quot;text&quot;]&#39;);\n    var main = document.querySelector(&#39;main&#39;);\n    var submit = document.querySelector(&#39;input[type=&quot;submit&quot;]&#39;);\n    var form_data = {};        \n\n    var updata = (function (){\n        var xhr = new XMLHttpRequest();                \n        xhr.onload = ()=&gt;{\n            var section = JSON.parse(xhr.response);\n            section.forEach((item)=&gt;{\n                var h = document.createElement(&#39;h&#39;);\n                h.textContent = item.name;\n                var p = document.createElement(&#39;p&#39;);\n                p.textContent = &#39;$&#39; + item.price;\n                var img = document.createElement(&#39;img&#39;);\n                img.setAttribute(&#39;src&#39;, &#39;./images/&#39;+item.image);\n                var sectionELe = document.createElement(&#39;section&#39;);\n                sectionELe.setAttribute(&#39;class&#39;, item.type);\n                sectionELe.appendChild(h);\n                sectionELe.appendChild(p);\n                sectionELe.appendChild(img);\n                main.appendChild(sectionELe);\n            });\n        }\n    \n        return function(url){            \n            xhr.open(&#39;GET&#39;, url);\n            xhr.responseType = &#39;json&#39;;            \n            xhr.send(null);\n        }        \n    })();\n    \n    submit.addEventListener(&#39;click&#39;, function(event){\n        event.preventDefault();\n        var _this = this;                \n        var str = &#39;&#39;;\n        (new FormData(form)).forEach((v,k)=&gt;{\n            form_data[k]=v;\n            str += (k + &#39;=&#39; + v + &#39;&amp;&#39;);\n        });\n        str = &#39;?&#39;+str.slice(0,-1);\n        updata(str);\n    });\n}</code>\n        </deckgo-highlight-code>\n<h3>服务端</h3>\n<deckgo-highlight-code language=\"js\" terminal=\"carbon\" theme=\"blackboard\"  >\n          <code slot=\"code\">var http = require(&#39;http&#39;);\nvar url = require(&#39;url&#39;);\nvar fs = require(&#39;fs&#39;);\nvar querystring = require(&#39;querystring&#39;);\nvar products = null;\nfs.readFile(&#39;./products.json&#39;, (err,data)=&gt;{\n    if(err){\n        console.error(`读取products.json 出错:${err}`);\n    }\n    else{            \n        products = data.toString();\n        console.log(`读取products.json成功`);\n    }\n});\n\nhttp.createServer(function(rqs, rsp){\n    var path = url.parse(rqs.url).pathname;    \n    var querys = url.parse(rqs.url).query;\n    var keys_values = querystring.parse(querys);\n    var keys = Object.keys(keys_values);\n    \n    console.log(`请求path: ${path}`);\n    if(querys){\n        console.log(&#39;响应keys&#39;);\n        rsp.writeHead(200, {&#39;Content-Type&#39;:&#39;text/json&#39;});\n        rsp.write(JSON.stringify(products));\n        rsp.end();\n    }\n    else if(path.indexOf(&#39;html&#39;)&gt;-1 || path.indexOf(&#39;css&#39;)&gt;-1 || path.indexOf(&#39;js&#39;)&gt;-1){\n        fs.readFile(path.substr(1), (err,data)=&gt;{\n            if(err){\n                console.error(err);\n            }\n            else{\n                console.log(&#39;响应path&#39;);\n                rsp.writeHead(200, {&#39;Content-Type&#39;:&#39;text/html&#39;});\n                rsp.write(data.toString());\n                rsp.end();\n            }   \n        });        \n    }\n    else if(path.indexOf(&#39;.jpg&#39;)&gt;-1){\n        console.log(&#39;响应images&#39;);\n        rsp.writeHead(200, {&#39;Content-Type&#39;:&#39;image/jpg&#39;});\n        var imageFilePath = path.substr(1);\n        \n        var stream = fs.createReadStream( imageFilePath );\n        var responseData = [];//存储文件流\n        if (stream) {//判断状态\n            stream.on( &#39;data&#39;, function( chunk ) {\n            responseData.push( chunk );\n            });\n            stream.on( &#39;end&#39;, function() {\n            var finalData = Buffer.concat( responseData );\n            rsp.write( finalData );\n            rsp.end();\n            });\n        }        \n    }\n    else{\n        console.error(&#39;path is error!&#39;);\n        rsp.writeHead(404, {&#39;Content-Type&#39;:&#39;text/html&#39;});\n        rsp.write(&#39;error&#39;);\n        rsp.end();\n    }    \n}).listen(80);\n\nconsole.log(&#39;Start server......&#39;);</code>\n        </deckgo-highlight-code>","id":"9a9e1546-3aee-50a4-a23f-ff0f91ea43d9","parent":{"__typename":"File","name":"Ajax请求","base":"Ajax请求.md","mtime":"2022-03-30T03:12:22.866Z","sourceInstanceName":"markdown"}}},"pageContext":{"articlePath":"/articles/前端/JS/Ajax请求/"}},"staticQueryHashes":["3957182205"]}