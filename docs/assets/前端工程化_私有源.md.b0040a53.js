import{_ as s,o as a,c as l,Q as n}from"./chunks/framework.cbe154cb.js";const h=JSON.parse('{"title":"组件打包","description":"","frontmatter":{},"headers":[],"relativePath":"前端工程化/私有源.md","filePath":"前端工程化/私有源.md"}'),p={name:"前端工程化/私有源.md"},o=n(`<h1 id="组件打包" tabindex="-1">组件打包 <a class="header-anchor" href="#组件打包" aria-label="Permalink to &quot;组件打包&quot;">​</a></h1><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ml-button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../src/components/button/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../lib</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">filename</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[name]/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">libraryTarget</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">umd</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span></code></pre></div><blockquote><p>组件配置了browser，引用组件的项目打包时会使用browser配置的umd.js，会将没有用到得代码一起打包， 只有让项目使用组件的index.js（es module）作为组件入口才不会将没有用到的代码打包，commonjs 也会打包没有使用的代码</p></blockquote><blockquote><p>每个icon组件都要单独export，这样项目中没有用到的icon就不会被打包</p></blockquote><blockquote><p>package.json type: module 没啥用</p></blockquote><blockquote><p>如果组件内使用了style/var.less 中的变量，并且不用lib作为组件入口，需要在使用该组件的项目中配置style-resources-loader并引入 @pic/style/var.less</p></blockquote><blockquote><p>npm pack命令进行本地模拟打包测试，在项目根目录下就会生成一个tgz的压缩包，这就是将要上传的文件内容。</p></blockquote><h2 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-label="Permalink to &quot;其他&quot;">​</a></h2><ul><li>confont-plugin-webpack</li></ul><hr><h1 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &quot;索引&quot;">​</a></h1><p>搭建 npm 私有源的方式有：</p><ol><li>verdaccion 搭建</li><li>Git 仓库作为私有源</li><li>cnpm 搭建</li></ol><h1 id="verdaccion-搭建" tabindex="-1"><a href="https://verdaccio.org/zh-cn/" target="_blank" rel="noreferrer">verdaccion 搭建</a> <a class="header-anchor" href="#verdaccion-搭建" aria-label="Permalink to &quot;[verdaccion 搭建](https://verdaccio.org/zh-cn/)&quot;">​</a></h1><blockquote><p>本地私有 NPM 注册中心</p></blockquote><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://localhost:4873</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://localhost:4873</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.npmrc</span></span>
<span class="line"><span style="color:#A6ACCD;">registry</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">http://localhost:4873</span></span></code></pre></div><ul><li>添加用户/登录</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">adduser</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">http://localhost:4873</span></span></code></pre></div><ul><li>发布包</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">publish</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://localhost:4873</span></span></code></pre></div><ul><li>安装包</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@xx/input</span></span></code></pre></div><h2 id="账号" tabindex="-1">账号 <a class="header-anchor" href="#账号" aria-label="Permalink to &quot;账号&quot;">​</a></h2><p>账号注册、删除、登录</p><p>通过 htpsaawd-for-sinopia 添加账号</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">htpasswd-for-sinopia</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span></span>
<span class="line"><span style="color:#FFCB6B;">sinopia-adduser</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 在 htpasswd 目录下执行</span></span></code></pre></div><h2 id="verdaccio-配置" tabindex="-1">Verdaccio 配置 <a class="header-anchor" href="#verdaccio-配置" aria-label="Permalink to &quot;Verdaccio 配置&quot;">​</a></h2><p>配置文件 ~/.config/verdaccio/config.yaml</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uplinks:</span></span>
<span class="line"><span style="color:#A6ACCD;">  npmjs:</span></span>
<span class="line"><span style="color:#A6ACCD;">    url: https:</span><span style="color:#676E95;font-style:italic;">//registry.npmjs.org/</span></span>
<span class="line"><span style="color:#A6ACCD;">  xnpmjs:</span></span>
<span class="line"><span style="color:#A6ACCD;">    url: http:</span><span style="color:#676E95;font-style:italic;">//registry.x.com </span></span>
<span class="line"><span style="color:#A6ACCD;">packages:</span></span>
<span class="line"><span style="color:#A6ACCD;">  &#39;@xscope/modulea&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">    access: $all</span></span>
<span class="line"><span style="color:#A6ACCD;">    publish: $authenticated</span></span>
<span class="line"><span style="color:#A6ACCD;">    unpublish: $authenticated</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy: xnpmjs </span><span style="color:#676E95;font-style:italic;">// proxy 代表如果在私有 npm 库找不到，则会代理到 npmjs</span></span></code></pre></div><blockquote><p>修改服务path</p><p>verdaccio内部使用了express，服务启用在了uri根路径，这样比较浪费资源。增加配置:</p><p><code>url_prefix: /npm/</code></p></blockquote><blockquote><p>npm login</p><p>只校验了 name password，没有校验email，每次login可以输入不同的email</p></blockquote><hr><blockquote><p>私有源使用</p></blockquote><ul><li>组件发布\\更新</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">publish</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xxx</span></span></code></pre></div><blockquote><p>登录登出私有源</p></blockquote><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">login</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--scope</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@mycorp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://registry.mycorp.com</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">logout</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--scope=@mycorp</span></span></code></pre></div><p>将 <code>@mycorp</code> 映射到指定 registry，之后执行 <code>npm install @mycorp/xx</code> 时从指定 registry 上安装</p><p>初始化一个带 scope 的 package</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--scope=@mycorp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--yes</span></span></code></pre></div><blockquote><p>常用命令</p></blockquote><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">whoami</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ls</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://registry.npmjs.org/</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@myco:registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://reg.example.com</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://registry.npm.taobao.org</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">owner</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">管理npm包的所有者</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">profile</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">password</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--registry</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://0.0.0.0:4873/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npmignore过滤文件了</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">publish</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">unpublish</span><span style="color:#A6ACCD;"> [\\&lt;package-spec\\&gt;]</span></span></code></pre></div><h2 id="其他-1" tabindex="-1">其他 <a class="header-anchor" href="#其他-1" aria-label="Permalink to &quot;其他&quot;">​</a></h2><ul><li>docker 安装</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">verdaccio/verdaccio:nightly-master</span></span></code></pre></div><ul><li>docker 运行</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">verdaccio</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4873</span><span style="color:#C3E88D;">:4873</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">verdaccio/verdaccio</span></span></code></pre></div><blockquote><p>使用npm link命令做本地代码调试，不需要频繁发布安装</p></blockquote><ul><li>npm link <ul><li>某个组件目录下执行 npm link</li><li>需要引用该组件的项目根目录下执行 npm link 该组件名</li></ul></li></ul><h2 id="文档" tabindex="-1">文档 <a class="header-anchor" href="#文档" aria-label="Permalink to &quot;文档&quot;">​</a></h2><p><a href="https://mp.weixin.qq.com/s/qgy82KMZKS_S5tfAFY4gNg" target="_blank" rel="noreferrer">verdaccio搭建npm私有源</a> ：nginx 代理配置 <a href="https://zhaomenghuan.js.org/blog/npm-private-repository-verdaccio.html#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-%E7%A7%81%E6%9C%89%E5%8C%85%E7%AE%A1%E7%90%86" target="_blank" rel="noreferrer">npm 私有仓库工具 Verdaccio 搭建</a> : 博客</p><h1 id="git仓库作为私有源" tabindex="-1">Git仓库作为私有源 <a class="header-anchor" href="#git仓库作为私有源" aria-label="Permalink to &quot;Git仓库作为私有源&quot;">​</a></h1><blockquote><p>Gitlab v13.7.x 自带私有仓库，只需要开启 Container Registry</p></blockquote><p>这个方法得益于，npm提供的的丰富安装方法。通过下面方法安装：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git+ssh://git@git.showgold.cn:npm/hello.git</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git+https://isaacs@github.com/npm/npm.git</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">git://github.com/npm/npm.git#v1.0.27</span></span></code></pre></div><ul><li>⚠️ 上面安装需要注意，你的工程一定是在某一个组下面建立，方便管理，在生成你的包的时候package.json中的name一定要带上范围</li><li>⚠️ 带版本信息的，必须通过 git 打 tag</li><li>特点 <ul><li>不用搭建服务</li><li>使用 npm update 是无法更新私有模块，想更新只能重新安装一次</li></ul></li></ul>`,56),e=[o];function t(c,r,i,C,y,D){return a(),l("div",null,e)}const d=s(p,[["render",t]]);export{h as __pageData,d as default};
